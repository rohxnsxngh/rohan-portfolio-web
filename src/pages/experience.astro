---
import { getCollection } from "astro:content";
import Layout from "../layouts/Layout.astro";
import { Image } from "astro:assets";
import Navbar from "../layouts/Navigation.astro";
import Footer from "../layouts/Footer.astro";

const allExperiences = await getCollection("experience");

// Sort experiences by date (most recent first)
const sortedExperiences = allExperiences.sort((a, b) => {
  return new Date(b.data.date).getTime() - new Date(a.data.date).getTime();
});
---

<Layout title="Experience">
  <div class="min-h-screen flex flex-col">
    <div class="flex-grow">
      <Navbar>
        <div class="sm:px-20 px-6 py-2">
          <h1 class="font-semibold sm:text-5xl text-3xl tracking-wider mb-4">
            Experience
          </h1>

          <div class="sm:text-sm text-xs tracking-wider mb-4 px-2">
            <span class="font-bold font-antialiasing tracking-widest">TLDR:</span> 
            <span class="text-slate-400/90 hover:underline hover:text-lime-600/90 decoration-2 underline-offset-4">BCG</span> →
            <span class="text-slate-400/90 hover:underline hover:text-cyan-600/90 decoration-2 underline-offset-4">OctaPulse</span> →
            <span class="text-slate-400/90 hover:underline hover:text-cyan-500/90 decoration-2 underline-offset-4">ASML</span> → <span
              class="text-slate-400/90 hover:underline hover:text-red-300/90 decoration-2 underline-offset-4">Toyota</span
            > → <span class="text-slate-400/90 hover:underline hover:text-red-500/90 decoration-2 underline-offset-4">Tesla</span> → <span
              class="text-slate-400/90 hover:underline hover:text-red-500/90 decoration-2 underline-offset-4">Tesla</span
            > 
            → 
            <span class="text-slate-400/90 hover:underline hover:text-lime-500/90 decoration-2 underline-offset-4">NVIDIA</span>
          </div>
          <div class="divider"></div>

          <div class="timeline-container relative max-w-5xl mx-auto mt-12">
            <!-- Timeline vertical line -->
            <div class="timeline-line absolute left-[20px] sm:left-[40px] top-0 bottom-0 w-[2px] bg-gradient-to-b from-primary/40 via-primary/20 to-transparent"></div>

            {
              sortedExperiences.map((experience, index) => {
                const companyFirstLetter = experience.data.company
                  .toLowerCase()
                  .charAt(0);
                const borderClass =
                  companyFirstLetter === "t"
                    ? "border-red-300/50 shadow-sm shadow-red-200/40"
                    : companyFirstLetter === "n"
                      ? "border-green-300/50 shadow-sm shadow-green-200/40"
                      : companyFirstLetter === "a"
                        ? "border-blue-300/50 shadow-sm shadow-cyan-300/90"
                        : "border-primary/20";

                return (
                  <div class="timeline-item relative pl-[60px] sm:pl-[100px] pb-12 group">
                    <!-- Timeline dot -->
                    <div class="timeline-dot absolute left-[11px] sm:left-[31px] top-[8px] w-[20px] h-[20px] rounded-full bg-black border-2 border-primary/60 z-10 transition-all duration-300 group-hover:border-primary group-hover:scale-125 group-hover:shadow-lg group-hover:shadow-primary/30"></div>

                    <!-- Comet Card -->
                    <div class="comet-card relative experience-card">
                      <div class="comet-card-inner relative p-6 rounded-xl bg-black/40 backdrop-blur-sm border border-primary/20 overflow-hidden transition-all duration-300 group-hover:border-primary/40">
                        <!-- Comet effect overlay -->
                        <div class="comet-overlay absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none"></div>

                        <div class="relative z-10">
                          <div class="flex sm:flex-row flex-col sm:items-center sm:justify-between gap-3 mb-3">
                            <h2 class="font-mono text-xl text-white/90">
                              {experience.data.title}
                            </h2>
                            <span
                              class={`text-xs font-mono px-3 py-1.5 rounded-lg bg-primary/10 text-primary/80 border ${borderClass} whitespace-nowrap w-fit`}
                            >
                              {experience.data.company}
                            </span>
                          </div>

                          <p class="text-base-content/50 mb-4 font-mono text-sm">
                            {experience.data.date}
                          </p>

                          <p class="text-base-content/70 mb-4 text-sm leading-relaxed">
                            {experience.data.description}
                          </p>

                          <div class="flex flex-wrap gap-2">
                            {experience.data.tags.map((tag: string) => (
                              <span class="text-xs px-2.5 py-1 rounded-md bg-accent/5 text-primary/60 border border-accent/10 hover:bg-accent/10 transition-colors duration-200">
                                {tag}
                              </span>
                            ))}
                          </div>
                        </div>
                      </div>

                      <a
                        href={`/experience/${experience.slug}`}
                        class="absolute inset-0 z-20"
                        aria-label={`View details for ${experience.data.title} at ${experience.data.company}`}
                      />
                    </div>
                  </div>
                );
              })
            }
          </div>
        </div>
      </Navbar>
    </div>
    <Footer />
  </div>
</Layout>

<style>
  /* Timeline animations */
  .timeline-item {
    animation: fadeInUp 0.6s ease-out backwards;
  }

  .timeline-item:nth-child(1) { animation-delay: 0.1s; }
  .timeline-item:nth-child(2) { animation-delay: 0.2s; }
  .timeline-item:nth-child(3) { animation-delay: 0.3s; }
  .timeline-item:nth-child(4) { animation-delay: 0.4s; }
  .timeline-item:nth-child(5) { animation-delay: 0.5s; }
  .timeline-item:nth-child(6) { animation-delay: 0.6s; }
  .timeline-item:nth-child(7) { animation-delay: 0.7s; }
  .timeline-item:nth-child(8) { animation-delay: 0.8s; }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Comet card effect */
  .comet-card {
    transition: transform 0.3s ease-out;
  }

  .comet-card:hover {
    transform: translateX(4px);
  }

  /* Comet overlay - minimalist light sweep effect */
  .comet-overlay {
    background: radial-gradient(
      600px circle at var(--mouse-x, 50%) var(--mouse-y, 50%),
      rgba(255, 255, 255, 0.06),
      transparent 40%
    );
  }

  /* Enhanced comet effect on hover with subtle glow */
  .comet-card-inner:hover .comet-overlay {
    background: radial-gradient(
      400px circle at var(--mouse-x, 50%) var(--mouse-y, 50%),
      rgba(255, 255, 255, 0.1),
      rgba(255, 255, 255, 0.02) 50%,
      transparent 80%
    );
  }
</style>

<script>
  // Comet effect - track mouse position on cards
  document.addEventListener('DOMContentLoaded', () => {
    const cards = document.querySelectorAll('.comet-card-inner');

    cards.forEach((card) => {
      card.addEventListener('mousemove', (e) => {
        const rect = (card as HTMLElement).getBoundingClientRect();
        const x = ((e.clientX - rect.left) / rect.width) * 100;
        const y = ((e.clientY - rect.top) / rect.height) * 100;

        (card as HTMLElement).style.setProperty('--mouse-x', `${x}%`);
        (card as HTMLElement).style.setProperty('--mouse-y', `${y}%`);
      });

      card.addEventListener('mouseleave', () => {
        (card as HTMLElement).style.setProperty('--mouse-x', '50%');
        (card as HTMLElement).style.setProperty('--mouse-y', '50%');
      });
    });
  });
</script>
