---
import { getCollection } from "astro:content";
import Layout from "../layouts/Layout.astro";
import { Image } from "astro:assets";
import Navbar from "../layouts/Navigation.astro";
import Footer from "../layouts/Footer.astro";

const allExperiences = await getCollection("experience");

// Sort experiences by date (most recent first)
const sortedExperiences = allExperiences.sort((a, b) => {
  return new Date(b.data.date).getTime() - new Date(a.data.date).getTime();
});
---

<Layout title="Experience">
  <div class="min-h-screen flex flex-col">
    <div class="flex-grow">
      <Navbar>
        <div class="sm:px-20 px-6 py-2">
          <h1 class="font-semibold sm:text-5xl text-3xl tracking-wider mb-4">
            Experience
          </h1>

          <div class="sm:text-sm text-xs tracking-wider mb-4 px-2">
            TLDR: <span class="text-slate-500/90 hover:underline hover:text-cyan-500/90 decoration-2 underline-offset-4">ASML</span> → <span
              class="text-slate-500/90 hover:underline hover:text-red-300/90 decoration-2 underline-offset-4">Toyota</span
            > → <span class="text-slate-500/90 hover:underline hover:text-red-500/90 decoration-2 underline-offset-4">Tesla</span> → <span
              class="text-slate-500/90 hover:underline hover:text-red-500/90 decoration-2 underline-offset-4">Tesla</span
            > → <span class="text-slate-500/90 hover:underline hover:text-lime-500/90 decoration-2 underline-offset-4">NVIDIA</span>
          </div>
          <div class="divider"></div>

          <div class="">
            {
              sortedExperiences.map((experience) => {
                const companyFirstLetter = experience.data.company
                  .toLowerCase()
                  .charAt(0);
                const borderClass =
                  companyFirstLetter === "t"
                    ? "border-red-300/50 shadow-sm shadow-red-200/40"
                    : companyFirstLetter === "n"
                      ? "border-green-300/50 shadow-sm shadow-green-200/40"
                      : companyFirstLetter === "a"
                        ? "border-blue-300/50 shadow-sm shadow-blue-200/40"
                        : "border-primary/20";

                return (
                  <div class="relative z-10 experience-card group my-4">
                    <div class="grid gap-6 p-4 rounded-xl bg-black transition-colors duration-300 relative z-10">
                      <div>
                        <div class="flex items-center gap-4 mb-2">
                          <h2 class="font-mono text-xl">
                            {experience.data.title}
                          </h2>
                          <span
                            class={`text-sm font-mono px-3 py-1 rounded-lg bg-primary/10 text-primary/80 border ${borderClass}`}
                          >
                            {experience.data.company}
                          </span>
                        </div>

                        <p class="text-base-content/60 mb-4 font-mono">
                          {experience.data.date}
                        </p>

                        <p class="text-base-content/80 mb-4">
                          {experience.data.description}
                        </p>

                        <div class="flex flex-wrap gap-2 mb-4">
                          {experience.data.tags.map((tag: string) => (
                            <span class="text-sm px-3 py-1 rounded-lg bg-accent/10 text-primary/70 border border-accent/20 hover:bg-accent/20 transition-colors duration-200">
                              {tag}
                            </span>
                          ))}
                        </div>
                      </div>
                    </div>
                    <div class="absolute inset-0 border border-primary/20 rounded-xl transform transition-all duration-300 group-hover:scale-105 group-hover:border-primary/40" />
                    <a
                      href={`/experience/${experience.slug}`}
                      class="absolute inset-0 z-20"
                      aria-hidden="true"
                    />
                  </div>
                  <div class="divider"></div>
                );
              })
            }
          </div>
        </div>
      </Navbar>
    </div>
    <Footer />
  </div>
</Layout>

<style>
  /* Add Tailwind's line-clamp utility if not available in your Tailwind setup */
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  /* Project card hover animation */
  .experience-card {
    transition: transform 0.3s ease-out;
  }

  .experience-card:hover {
    transform: translateY(-4px);
  }
</style>
