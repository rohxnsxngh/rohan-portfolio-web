---
import { getCollection } from "astro:content";
import Layout from "../layouts/Layout.astro";
import Navbar from "../layouts/Navigation.astro";
import Footer from "../layouts/Footer.astro";

const allExperiences = await getCollection("experience");

// Sort experiences by date (most recent first)
const sortedExperiences = allExperiences.sort((a, b) => {
  return new Date(b.data.date).getTime() - new Date(a.data.date).getTime();
});
---

<Layout title="Experience">
  <div class="min-h-screen flex flex-col bg-secondary">
    <div class="flex-grow">
      <Navbar>
        <div class="relative overflow-hidden">
          <!-- Tech grid overlay -->
          <div class="absolute inset-0 tech-grid opacity-10 z-0 pointer-events-none"></div>

          <div class="relative z-10 sm:px-20 px-6 py-12">
            <!-- BOLD HEADER -->
            <div class="header-section mb-12">
              <h1 class="experience-title font-mono font-black tracking-tighter leading-none select-none">
                <span class="char char-1">E</span><span class="char char-2">X</span><span class="char char-3">P</span><span class="char char-4">E</span><span class="char char-5">R</span><span class="char char-6">I</span><span class="char char-7">E</span><span class="char char-8">N</span><span class="char char-9">C</span><span class="char char-10">E</span>
              </h1>
              <div class="accent-line mt-6"></div>
            </div>

            <!-- JOURNEY TLDR -->
            <div class="journey-section mb-16 opacity-0" style="animation: fadeInUp 0.8s ease-out forwards; animation-delay: 0.8s;">
              <p class="font-mono text-[10px] sm:text-xs tracking-[0.3em] text-primary/30 mb-6 uppercase">
                Career Journey
              </p>
              <div class="journey-path font-mono text-xs sm:text-sm flex flex-wrap gap-2 items-center">
                <span class="company-chip green">NVIDIA</span>
                <span class="arrow">→</span>
                <span class="company-chip red-bright">Tesla</span>
                <span class="arrow">→</span>
                <span class="company-chip red-bright">Tesla</span>
                <span class="arrow">→</span>
                <span class="company-chip red">Toyota</span>
                <span class="arrow">→</span>
                <span class="company-chip cyan-bright">ASML</span>
                <span class="arrow">→</span>
                <span class="company-chip cyan">OctaPulse</span>
                <span class="arrow">→</span>
                <span class="company-chip lime">BCG</span>
              </div>
            </div>

            <!-- 3D ILLUMINATED TIMELINE -->
            <div id="experience-timeline" class="relative min-h-screen">
              <!-- Cards Container -->
              <div class="cards-container relative z-10 w-full space-y-8 pb-20">
                {sortedExperiences.map((experience, index) => {
                  const companyFirstLetter = experience.data.company.toLowerCase().charAt(0);
                  const borderClass =
                    companyFirstLetter === "t"
                      ? "border-red-300/50"
                      : companyFirstLetter === "n"
                        ? "border-green-300/50"
                        : companyFirstLetter === "a"
                          ? "border-cyan-300/50"
                          : "border-primary/20";

                  const colorClass =
                    companyFirstLetter === "t"
                      ? "text-red-300/80"
                      : companyFirstLetter === "n"
                        ? "text-green-300/80"
                        : companyFirstLetter === "a"
                          ? "text-cyan-300/80"
                          : "text-primary/80";

                  return (
                    <div
                      class="experience-card group"
                      data-index={index}
                      data-company={experience.data.company.toLowerCase()}
                      style={`animation-delay: ${1.2 + index * 0.1}s;`}
                    >
                      <!-- Corner accent marks -->
                      <div class="card-corner-accent card-corner-tl"></div>
                      <div class="card-corner-accent card-corner-tr"></div>
                      <div class="card-corner-accent card-corner-bl"></div>
                      <div class="card-corner-accent card-corner-br"></div>

                      <!-- Animated gradient border -->
                      <div class="card-gradient-border"></div>

                      <!-- Grid overlay -->
                      <div class="card-grid-overlay"></div>

                      <!-- Glow overlay that follows mouse (warm colored) -->
                      <div class="glow-overlay-warm"></div>

                      <!-- Clean Minimalist Card -->
                      <a href={`/experience/${experience.slug}`} class="card-link block relative group">
                        <!-- The card content -->
                        <div class="card-content relative p-8 sm:p-12 overflow-hidden transition-all duration-500">
                          <!-- Subtle accent line -->
                          <div class={`accent-bar absolute left-0 top-0 w-1 h-0 ${borderClass} transition-all duration-500 group-hover:h-full`}></div>

                          <!-- Illumination glow effect -->
                          <div class="card-glow absolute inset-0 opacity-0 transition-opacity duration-500 pointer-events-none" style="background: radial-gradient(circle 400px at var(--mouse-x, 50%) var(--mouse-y, 50%), rgba(255, 255, 255, 0.03), transparent);"></div>

                          <div class="relative z-10">
                            <!-- Header -->
                            <div class="flex items-start justify-between gap-6 mb-8">
                              <div class="flex-1">
                                <h2 class="font-mono text-3xl sm:text-4xl text-white/95 font-bold tracking-tight leading-tight mb-3 group-hover:text-white transition-colors duration-300">
                                  {experience.data.title}
                                </h2>
                                <p class="text-primary/40 font-mono text-xs tracking-[0.2em] uppercase">
                                  {experience.data.date}
                                </p>
                              </div>
                              <span class={`company-badge font-mono text-sm px-4 py-2 rounded border ${borderClass} ${colorClass} whitespace-nowrap`}>
                                {experience.data.company}
                              </span>
                            </div>

                            <!-- Description -->
                            <p class="text-primary/70 mb-8 text-base leading-relaxed max-w-3xl group-hover:text-primary/90 transition-colors duration-300">
                              {experience.data.description}
                            </p>

                            <!-- Tags -->
                            <div class="flex flex-wrap gap-2 mb-8">
                              {experience.data.tags.map((tag: string) => (
                                <span class="text-xs px-3 py-1.5 rounded bg-primary/5 text-primary/50 border border-primary/10 font-mono group-hover:bg-primary/10 group-hover:text-primary/70 group-hover:border-primary/20 transition-all duration-300">
                                  {tag}
                                </span>
                              ))}
                            </div>

                            <!-- Call to action -->
                            <div class="text-primary/30 font-mono text-sm flex items-center gap-2 group-hover:text-primary/70 transition-all duration-300">
                              <span>View details</span>
                              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 group-hover:translate-x-1 transition-transform duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M17 8l4 4m0 0l-4 4m4-4H3" />
                              </svg>
                            </div>
                          </div>
                        </div>
                      </a>
                    </div>
                  );
                })}
              </div>
            </div>
          </div>
        </div>
      </Navbar>
    </div>
    <Footer />
  </div>
</Layout>

<style>
  /* Tech grid background */
  .tech-grid {
    background-image:
      linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
    background-size: 100px 100px;
    animation: gridPan 60s linear infinite;
  }

  @keyframes gridPan {
    0% { background-position: 0 0; }
    100% { background-position: 100px 100px; }
  }

  /* BOLD EXPERIENCE TITLE */
  .experience-title {
    font-size: clamp(3rem, 12vw, 12rem);
    line-height: 0.85;
    letter-spacing: -0.08em;
    color: #ffffff;
    text-transform: uppercase;
    opacity: 0;
    animation: titleReveal 1.2s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    text-shadow:
      0 3px 25px rgba(0, 0, 0, 0.9),
      0 6px 45px rgba(0, 0, 0, 0.7);
  }

  @keyframes titleReveal {
    from {
      opacity: 0;
      transform: translateY(50px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Character animations */
  .experience-title .char {
    display: inline-block;
    opacity: 0;
    transform: translateY(100px) scale(0.8);
    animation: charReveal 1s cubic-bezier(0.16, 1, 0.3, 1) forwards;
  }

  .char-1 { animation-delay: 0.05s; }
  .char-2 { animation-delay: 0.10s; }
  .char-3 { animation-delay: 0.15s; }
  .char-4 { animation-delay: 0.20s; }
  .char-5 { animation-delay: 0.25s; }
  .char-6 { animation-delay: 0.30s; }
  .char-7 { animation-delay: 0.35s; }
  .char-8 { animation-delay: 0.40s; }
  .char-9 { animation-delay: 0.45s; }
  .char-10 { animation-delay: 0.50s; }

  @keyframes charReveal {
    0% {
      opacity: 0;
      transform: translateY(100px) scale(0.8);
    }
    60% {
      transform: translateY(-10px) scale(1.02);
    }
    100% {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }

  /* Accent line */
  .accent-line {
    height: 3px;
    width: 0;
    background: linear-gradient(90deg, rgba(255, 255, 255, 0.8), transparent);
    animation: lineExpand 1.5s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    animation-delay: 0.6s;
  }

  @keyframes lineExpand {
    to {
      width: 200px;
    }
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Journey section */
  .journey-path {
    line-height: 2;
  }

  .company-chip {
    padding: 0.35rem 0.75rem;
    border-radius: 0.25rem;
    font-weight: 500;
    border: 1px solid;
    transition: all 0.4s ease;
    letter-spacing: 0.05em;
  }

  .company-chip.lime {
    color: rgba(150, 255, 150, 0.5);
    border-color: rgba(150, 255, 150, 0.2);
    background: rgba(150, 255, 150, 0.03);
  }

  .company-chip.lime:hover {
    color: rgba(150, 255, 150, 0.8);
    border-color: rgba(150, 255, 150, 0.5);
    background: rgba(150, 255, 150, 0.08);
  }

  .company-chip.cyan {
    color: rgba(100, 200, 255, 0.5);
    border-color: rgba(100, 200, 255, 0.2);
    background: rgba(100, 200, 255, 0.03);
  }

  .company-chip.cyan:hover {
    color: rgba(100, 200, 255, 0.8);
    border-color: rgba(100, 200, 255, 0.5);
    background: rgba(100, 200, 255, 0.08);
  }

  .company-chip.cyan-bright {
    color: rgba(0, 255, 255, 0.5);
    border-color: rgba(0, 255, 255, 0.2);
    background: rgba(0, 255, 255, 0.03);
  }

  .company-chip.cyan-bright:hover {
    color: rgba(0, 255, 255, 0.8);
    border-color: rgba(0, 255, 255, 0.5);
    background: rgba(0, 255, 255, 0.08);
  }

  .company-chip.red {
    color: rgba(255, 150, 150, 0.5);
    border-color: rgba(255, 150, 150, 0.2);
    background: rgba(255, 150, 150, 0.03);
  }

  .company-chip.red:hover {
    color: rgba(255, 150, 150, 0.8);
    border-color: rgba(255, 150, 150, 0.5);
    background: rgba(255, 150, 150, 0.08);
  }

  .company-chip.red-bright {
    color: rgba(255, 100, 100, 0.5);
    border-color: rgba(255, 100, 100, 0.2);
    background: rgba(255, 100, 100, 0.03);
  }

  .company-chip.red-bright:hover {
    color: rgba(255, 100, 100, 0.8);
    border-color: rgba(255, 100, 100, 0.5);
    background: rgba(255, 100, 100, 0.08);
  }

  .company-chip.green {
    color: rgba(150, 255, 150, 0.5);
    border-color: rgba(150, 255, 150, 0.2);
    background: rgba(150, 255, 150, 0.03);
  }

  .company-chip.green:hover {
    color: rgba(150, 255, 150, 0.8);
    border-color: rgba(150, 255, 150, 0.5);
    background: rgba(150, 255, 150, 0.08);
  }

  .arrow {
    color: rgba(255, 255, 255, 0.2);
    font-size: 0.75rem;
  }

  /* Experience Cards */
  .experience-card {
    opacity: 0;
    animation: fadeInUp 0.8s ease-out forwards;
    position: relative;
    overflow: hidden;
  }

  /* Corner accent marks */
  .card-corner-accent {
    position: absolute;
    width: 20px;
    height: 20px;
    border: 2px solid rgba(255, 255, 255, 0.4);
    z-index: 15;
    pointer-events: none;
    transition: all 0.3s ease;
    opacity: 1;
  }

  .card-corner-tl {
    top: -1px;
    left: -1px;
    border-right: none;
    border-bottom: none;
    border-radius: 12px 0 0 0;
  }

  .card-corner-tr {
    top: -1px;
    right: -1px;
    border-left: none;
    border-bottom: none;
    border-radius: 0 12px 0 0;
  }

  .card-corner-bl {
    bottom: -1px;
    left: -1px;
    border-right: none;
    border-top: none;
    border-radius: 0 0 0 12px;
  }

  .card-corner-br {
    bottom: -1px;
    right: -1px;
    border-left: none;
    border-top: none;
    border-radius: 0 0 12px 0;
  }

  .experience-card:hover .card-corner-accent {
    width: 30px;
    height: 30px;
    border-color: rgba(255, 255, 255, 0.8);
    filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.5));
  }

  /* Animated gradient border */
  .card-gradient-border {
    position: absolute;
    inset: -2px;
    border-radius: 0;
    padding: 2px;
    background: linear-gradient(
      45deg,
      transparent,
      rgba(0, 255, 255, 0.3),
      transparent,
      rgba(255, 0, 255, 0.3),
      transparent
    );
    background-size: 200% 200%;
    -webkit-mask:
      linear-gradient(#fff 0 0) content-box,
      linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
    animation: borderGlow 4s linear infinite;
    opacity: 0.6;
    pointer-events: none;
    z-index: 5;
  }

  @keyframes borderGlow {
    0%, 100% {
      background-position: 0% 50%;
    }
    50% {
      background-position: 100% 50%;
    }
  }

  .experience-card:hover .card-gradient-border {
    opacity: 1;
    animation-duration: 2s;
  }

  /* Grid overlay */
  .card-grid-overlay {
    position: absolute;
    inset: 0;
    border-radius: 0;
    background-image:
      linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
    background-size: 20px 20px;
    pointer-events: none;
    z-index: 11;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .experience-card:hover .card-grid-overlay {
    opacity: 1;
  }

  /* Mouse-following warm glow effect */
  .glow-overlay-warm {
    position: absolute;
    inset: 0;
    border-radius: 0;
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
    z-index: 5;
    background: radial-gradient(
      600px circle at var(--mouse-x, 50%) var(--mouse-y, 50%),
      rgba(255, 102, 0, 0.15),
      rgba(255, 170, 68, 0.1),
      rgba(255, 68, 68, 0.05),
      transparent 40%
    );
  }

  .experience-card:hover .glow-overlay-warm {
    opacity: 1;
  }

  /* Card content - clean minimal design */
  .card-content {
    background: rgba(0, 0, 0, 0.4);
    border: 1px solid rgba(255, 255, 255, 0.05);
    border-radius: 0;
    backdrop-filter: blur(10px);
  }

  .experience-card:hover .card-content {
    background: rgba(0, 0, 0, 0.5);
    border-color: rgba(255, 255, 255, 0.3);
    box-shadow:
      inset 0 1px 0 rgba(255, 255, 255, 0.1),
      0 20px 40px rgba(0, 0, 0, 0.6),
      0 0 40px rgba(0, 255, 255, 0.1),
      0 0 80px rgba(255, 0, 255, 0.1);
  }

  /* Responsive corner accents for smaller screens */
  @media (max-width: 640px) {
    .card-corner-accent {
      width: 15px;
      height: 15px;
    }

    .experience-card:hover .card-corner-accent {
      width: 20px;
      height: 20px;
    }
  }

  /* Accent bar */
  .accent-bar {
    background: currentColor;
  }

  /* Subtle glow on hover */
  .experience-card:hover .card-glow {
    opacity: 1;
  }

  /* Company badge */
  .company-badge {
    background: rgba(0, 0, 0, 0.3);
    transition: all 0.3s ease;
  }

  .experience-card:hover .company-badge {
    background: rgba(0, 0, 0, 0.5);
  }

  /* Timeline container */
  #experience-timeline {
    position: relative;
  }

  /* Responsive */
  @media (max-width: 1024px) {
    .experience-title {
      font-size: clamp(2.5rem, 10vw, 10rem);
    }
  }

  @media (max-width: 768px) {
    .experience-title {
      font-size: clamp(2rem, 12vw, 8rem);
    }

    .card-content {
      padding: 1.5rem;
    }
  }

  @media (max-width: 640px) {
    .experience-title {
      font-size: clamp(1.8rem, 14vw, 6rem);
    }

    .card-content {
      padding: 1.25rem;
    }
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const cards = document.querySelectorAll(".experience-card");

    // Track mouse position within each card for subtle glow effect
    cards.forEach((card) => {
      const cardEl = card as HTMLElement;
      const cardContent = cardEl.querySelector(".card-content") as HTMLElement;
      const glow = cardEl.querySelector(".card-glow") as HTMLElement;
      const glowOverlayWarm = cardEl.querySelector<HTMLElement>(".glow-overlay-warm");

      if (cardContent && glow) {
        cardContent.addEventListener("mousemove", (e) => {
          const rect = cardContent.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;

          glow.style.setProperty("--mouse-x", `${x}px`);
          glow.style.setProperty("--mouse-y", `${y}px`);
        });

        cardContent.addEventListener("mouseleave", () => {
          glow.style.setProperty("--mouse-x", "50%");
          glow.style.setProperty("--mouse-y", "50%");
        });
      }

      // Handle warm glow overlay
      if (glowOverlayWarm) {
        cardEl.addEventListener("mousemove", (e) => {
          const rect = cardEl.getBoundingClientRect();
          const x = ((e.clientX - rect.left) / rect.width) * 100;
          const y = ((e.clientY - rect.top) / rect.height) * 100;

          glowOverlayWarm.style.setProperty("--mouse-x", `${x}%`);
          glowOverlayWarm.style.setProperty("--mouse-y", `${y}%`);
        });

        cardEl.addEventListener("mouseleave", () => {
          glowOverlayWarm.style.setProperty("--mouse-x", "50%");
          glowOverlayWarm.style.setProperty("--mouse-y", "50%");
        });
      }
    });
  });
</script>
