---
import Navbar from "../layouts/Navigation.astro";
import Footer from "../layouts/Footer.astro";
import Layout from "../layouts/Layout.astro";
import BlogRobotViewer from "../components/BlogRobotViewer.astro";
import { calculateReadingTime, formatReadingTime } from "../utils/readingTime";

import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";

const allBlogArticles: CollectionEntry<"blog">[] = await getCollection("blog");
---

<Layout>
  <Navbar>
    <!-- HERO SECTION - Full page keyboard background like homepage -->
    <div
      class="hero-section relative min-h-screen bg-secondary flex items-center justify-center overflow-hidden"
      id="hero-section"
    >
      <!-- FULL PAGE KEYBOARD BACKGROUND -->
      <div class="robot-background-container absolute inset-0 z-0" id="robot-container">
        <div class="robot-frame-fullscreen w-full h-full">
          <div class="w-full h-full robot-viewer" id="robot-viewer">
            <BlogRobotViewer />
          </div>
        </div>

        <!-- Dark overlay to dim keyboard heavily by default -->
        <div class="robot-overlay absolute inset-0 bg-black/[0.98] pointer-events-none transition-all duration-500" id="robot-dim"></div>
      </div>

      <!-- Tech grid overlay for texture -->
      <div class="absolute inset-0 tech-grid opacity-10 z-[5] pointer-events-none"></div>

      <!-- Main content - layered on top -->
      <div class="hero-content relative z-10 w-full px-4 sm:px-6 lg:px-8 pointer-events-none transition-opacity duration-300" id="hero-content">
        <div class="max-w-7xl mx-auto">
          <!-- Small intro label -->
          <div class="label-intro mb-6 sm:mb-8">
            <span class="text-primary/50 font-mono text-xs sm:text-sm tracking-[0.3em] uppercase">
              Thoughts • Ideas • Insights
            </span>
          </div>

          <!-- MASSIVE title display -->
          <div class="name-display mb-6 sm:mb-10">
            <h1 class="hero-name font-mono font-black tracking-tighter leading-none select-none">
              <div class="name-line">
                <span class="char char-1">C</span><span class="char char-2">H</span><span class="char char-3">R</span><span class="char char-4">O</span><span class="char char-5">N</span><span class="char char-6">I</span><span class="char char-7">C</span><span class="char char-8">L</span><span class="char char-9">E</span><span class="char char-10">S</span>
              </div>
            </h1>
          </div>

          <!-- Bold statement -->
          <div class="statement mb-8 sm:mb-12 max-w-4xl">
            <p class="statement-text text-primary/60 font-mono tracking-wide leading-relaxed">
              <span class="highlight">Unfiltered thoughts</span> on tech and life
            </p>
          </div>

          <!-- CTA Section -->
          <div class="cta-section flex flex-col sm:flex-row gap-4 sm:gap-6 items-start sm:items-center pointer-events-auto">
            <a
              href="#blog-content"
              class="cta-primary group relative inline-flex items-center justify-center px-7 py-3 bg-primary text-secondary font-mono text-sm sm:text-base tracking-wider font-bold overflow-hidden transition-all duration-300 hover:scale-105 hover:shadow-2xl hover:shadow-primary/40"
            >
              <span class="relative z-10">READ ARTICLES</span>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-5 w-5 ml-3 group-hover:translate-y-1 transition-transform relative z-10"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2.5"
                  d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
              </svg>
              <div class="cta-shine"></div>
            </a>

            <a
              href="/"
              class="cta-secondary group inline-flex items-center text-primary/70 hover:text-primary font-mono text-sm sm:text-base tracking-wider transition-all duration-300"
            >
              Back to home
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-4 w-4 ml-2 group-hover:-translate-x-1 transition-transform"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M7 16l-4-4m0 0l4-4m-4 4h18"></path>
              </svg>
            </a>
          </div>
        </div>
      </div>

      <!-- Scroll Indicator -->
      <div class="scroll-indicator absolute bottom-8 left-1/2 -translate-x-1/2 z-20 pointer-events-none">
        <div class="scroll-content flex flex-col items-center gap-2">
          <span class="text-primary/40 font-mono text-xs tracking-widest uppercase">Scroll</span>
          <div class="scroll-arrow">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-primary/40" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
            </svg>
          </div>
        </div>
      </div>
    </div>

    <!-- BLOG CONTENT SECTION -->
    <div class="relative bg-secondary" id="blog-content">
      <!-- Tech grid overlay -->
      <div class="absolute inset-0 tech-grid opacity-10 z-0 pointer-events-none"></div>

      <div class="relative z-10 sm:px-20 px-6 py-16">
        <!-- Search Bar -->
        <div class="mb-8 relative">
          <div class="relative">
            <input
              type="text"
              id="searchInput"
              placeholder="Search articles..."
              class="w-full p-3 pl-10 rounded-lg border border-accent/30 bg-secondary focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-transparent"
            />
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-primary/60"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
          </div>
          <div id="searchStatus" class="text-sm mt-2 text-primary/60 hidden"></div>
        </div>

        <!-- Table of Contents - Quick Jump -->
        <div class="toc-container mb-10 relative overflow-hidden">
          <div class="toc-header flex items-center gap-3 mb-4">
            <div class="toc-icon">
              <svg class="w-5 h-5 text-primary/60" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16" />
              </svg>
            </div>
            <span class="text-sm font-mono text-primary/50 uppercase tracking-widest">Quick Jump</span>
            <div class="flex-grow h-px bg-gradient-to-r from-primary/20 to-transparent"></div>
          </div>
          <div class="toc-list flex flex-wrap gap-2" id="tocList">
            {allBlogArticles.map((article, index) => {
              const isComplete = article.data.status === "Complete";
              return (
                <button
                  class="toc-item group"
                  data-slug={article.slug}
                  data-index={index}
                >
                  <span class="toc-number font-mono text-xs text-primary/30 mr-1.5">{String(index + 1).padStart(2, '0')}</span>
                  <span class="toc-title">{article.data.title}</span>
                  {isComplete && <span class="toc-status-dot"></span>}
                </button>
              );
            })}
          </div>
        </div>

        <!-- Blog Grid -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8" id="blogGrid">
          {allBlogArticles.map((article) => {
            const tags: string[] = article.data.tags || [];
            const defaultStatus = "Coming Soon";
            const actualStatus = article.data.status || defaultStatus;
            const isComplete = actualStatus === "Complete";
            const statusDisplay = isComplete ? "Complete" : defaultStatus;
            const readingTime = calculateReadingTime(article.body);

            return (
              <a href={`/blog/${article.slug}`} class="group h-full relative blog-card">
                <!-- Corner accent marks -->
                <div class="card-corner-accent card-corner-tl"></div>
                <div class="card-corner-accent card-corner-tr"></div>
                <div class="card-corner-accent card-corner-bl"></div>
                <div class="card-corner-accent card-corner-br"></div>

                <!-- Animated gradient border -->
                <div class="card-gradient-border"></div>

                <!-- Grid overlay -->
                <div class="card-grid-overlay"></div>

                <!-- Glow overlay that follows mouse -->
                <div class="glow-overlay"></div>

                <div class="card-content p-6 border border-accent/20 rounded-xl bg-secondary hover:bg-accent/5 transition-all duration-300 transform hover:-translate-y-1 hover:shadow-xl h-full flex flex-col relative z-10">
                  <div class="flex flex-col h-full">
                    <div class="flex justify-between items-start mb-3">
                      <h2 class="text-xl font-bold group-hover:text-primary/90 transition-colors">{article.data.title}</h2>
                      <span class={`px-2 py-0.5 ml-2 rounded-full text-xs whitespace-nowrap flex-shrink-0 ${isComplete ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' : 'bg-amber-100 text-amber-800 dark:bg-amber-900 dark:text-amber-200'}`}>
                        {statusDisplay}
                      </span>
                    </div>
                    <div class="flex items-center gap-3 text-sm text-primary/60 mb-4">
                      <span>{new Date(article.data.date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</span>
                      <span class="text-primary/30">•</span>
                      <span class="flex items-center gap-1">
                        <svg class="h-3.5 w-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        {formatReadingTime(readingTime)}
                      </span>
                    </div>
                    <p class="text-primary/80 flex-grow line-clamp-3">{article.data.description}</p>
                    <div class="mt-4 flex flex-wrap gap-2">
                      {tags.map(tag => (
                        <span class="px-3 py-1 text-xs rounded-full bg-accent/10 text-primary/70">{tag}</span>
                      ))}
                    </div>
                  </div>
                </div>
              </a>
            );
          })}
        </div>
      </div>
    </div>
  </Navbar>
  <Footer />
</Layout>

<style>
  /* ===== HERO SECTION STYLES (matching homepage) ===== */

  /* Tech grid background */
  .tech-grid {
    background-image:
      linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
    background-size: 100px 100px;
    animation: gridPan 60s linear infinite;
  }

  @keyframes gridPan {
    0% { background-position: 0 0; }
    100% { background-position: 100px 100px; }
  }

  /* ===== MASSIVE TYPOGRAPHY ===== */
  .hero-name {
    font-size: clamp(2rem, 9vw, 14rem);
    line-height: 0.85;
    letter-spacing: -0.05em;
    color: #ffffff;
    text-transform: uppercase;
    font-weight: 900;
    -webkit-text-stroke: 1px rgba(255, 255, 255, 0.3);
    white-space: nowrap;
  }

  .hero-name .name-line {
    display: block;
    position: relative;
  }

  /* Individual character animations */
  .hero-name .char {
    display: inline-block;
    opacity: 0;
    transform: translateY(100px) scale(0.8);
    animation: charReveal 1s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    text-shadow:
      0 0 40px rgba(255, 255, 255, 0.1),
      0 10px 30px rgba(0, 0, 0, 0.5);
  }

  /* Staggered animation delays */
  .char-1 { animation-delay: 0.05s; }
  .char-2 { animation-delay: 0.10s; }
  .char-3 { animation-delay: 0.15s; }
  .char-4 { animation-delay: 0.20s; }
  .char-5 { animation-delay: 0.25s; }
  .char-6 { animation-delay: 0.30s; }
  .char-7 { animation-delay: 0.35s; }
  .char-8 { animation-delay: 0.40s; }
  .char-9 { animation-delay: 0.45s; }
  .char-10 { animation-delay: 0.50s; }

  @keyframes charReveal {
    0% {
      opacity: 0;
      transform: translateY(100px) scale(0.8);
    }
    60% {
      transform: translateY(-10px) scale(1.02);
    }
    100% {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }

  /* Label intro animation */
  .label-intro {
    opacity: 0;
    animation: fadeInDown 0.8s ease-out forwards;
  }

  @keyframes fadeInDown {
    from {
      opacity: 0;
      transform: translateY(-20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Statement text */
  .statement {
    opacity: 0;
    animation: fadeInUp 1s ease-out forwards;
    animation-delay: 0.6s;
  }

  .statement-text {
    font-size: clamp(1rem, 2.5vw, 1.5rem);
    line-height: 1.6;
  }

  .highlight {
    color: #ffffff;
    font-weight: 700;
    position: relative;
  }

  .highlight::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 2px;
    background: linear-gradient(90deg, rgba(255, 255, 255, 0.5), transparent);
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* CTA Section */
  .cta-section {
    opacity: 0;
    animation: fadeInUp 1s ease-out forwards;
    animation-delay: 0.8s;
  }

  /* Primary CTA Button */
  .cta-primary {
    position: relative;
    clip-path: polygon(0 0, 100% 0, 100% 100%, 0 100%);
  }

  .cta-shine {
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    transition: left 0.7s;
  }

  .cta-primary:hover .cta-shine {
    left: 100%;
  }

  /* Secondary CTA */
  .cta-secondary {
    text-decoration: underline;
    text-decoration-color: rgba(255, 255, 255, 0.2);
    text-underline-offset: 6px;
    text-decoration-thickness: 1px;
  }

  .cta-secondary:hover {
    text-decoration-color: rgba(255, 255, 255, 0.6);
  }

  /* ===== KEYBOARD AS FULL BACKGROUND ===== */

  .robot-background-container {
    opacity: 1;
  }

  .robot-frame-fullscreen {
    position: absolute;
    inset: 0;
  }

  /* Overlay - dims the keyboard heavily, lightens on hover */
  .robot-overlay {
    z-index: 1;
    transition: background 0.6s ease-out;
  }

  /* Hero content with slower fade transitions */
  .hero-content {
    opacity: 1;
    transition: opacity 0.5s ease-out;
  }

  /* Typography with enhanced text shadow for readability */
  .hero-name {
    text-shadow:
      0 3px 25px rgba(0, 0, 0, 0.9),
      0 6px 45px rgba(0, 0, 0, 0.7),
      0 0 80px rgba(0, 0, 0, 0.5);
  }

  .statement-text,
  .label-intro span {
    text-shadow:
      0 2px 15px rgba(0, 0, 0, 0.95),
      0 4px 25px rgba(0, 0, 0, 0.8);
  }

  /* Mouse interaction states */
  .hero-section.mouse-active .hero-content {
    opacity: 0.05;
    transition: opacity 0.6s ease-out;
  }

  .hero-section.mouse-active .robot-overlay {
    background: rgba(0, 0, 0, 0.2) !important;
  }

  /* When mouse becomes inactive, fade back slowly */
  .hero-section:not(.mouse-active) .hero-content {
    transition: opacity 2s ease-in-out;
  }

  .hero-section:not(.mouse-active) .robot-overlay {
    transition: background 2.5s ease-in-out;
  }

  /* Prevent layout shift */
  .hero-section {
    min-height: 100vh;
    min-height: 100dvh;
  }

  /* ===== BLOG CARDS ===== */

  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .blog-card {
    transition: transform 0.3s ease-out;
    overflow: hidden;
  }

  .blog-card:hover {
    transform: translateY(-4px);
  }

  /* Corner accent marks */
  .card-corner-accent {
    position: absolute;
    width: 20px;
    height: 20px;
    border: 2px solid rgba(255, 255, 255, 0.4);
    z-index: 15;
    pointer-events: none;
    transition: all 0.3s ease;
    opacity: 1;
  }

  .card-corner-tl {
    top: -1px;
    left: -1px;
    border-right: none;
    border-bottom: none;
    border-radius: 12px 0 0 0;
  }

  .card-corner-tr {
    top: -1px;
    right: -1px;
    border-left: none;
    border-bottom: none;
    border-radius: 0 12px 0 0;
  }

  .card-corner-bl {
    bottom: -1px;
    left: -1px;
    border-right: none;
    border-top: none;
    border-radius: 0 0 0 12px;
  }

  .card-corner-br {
    bottom: -1px;
    right: -1px;
    border-left: none;
    border-top: none;
    border-radius: 0 0 12px 0;
  }

  .blog-card:hover .card-corner-accent {
    width: 30px;
    height: 30px;
    border-color: rgba(255, 255, 255, 0.8);
    filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.5));
  }

  /* Animated gradient border */
  .card-gradient-border {
    position: absolute;
    inset: -2px;
    border-radius: 0.75rem;
    padding: 2px;
    background: linear-gradient(
      45deg,
      transparent,
      rgba(0, 255, 255, 0.3),
      transparent,
      rgba(255, 0, 255, 0.3),
      transparent
    );
    background-size: 200% 200%;
    -webkit-mask:
      linear-gradient(#fff 0 0) content-box,
      linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
    animation: borderGlow 4s linear infinite;
    opacity: 0.6;
    pointer-events: none;
    z-index: 5;
  }

  @keyframes borderGlow {
    0%, 100% {
      background-position: 0% 50%;
    }
    50% {
      background-position: 100% 50%;
    }
  }

  .blog-card:hover .card-gradient-border {
    opacity: 1;
    animation-duration: 2s;
  }

  /* Grid overlay */
  .card-grid-overlay {
    position: absolute;
    inset: 0;
    border-radius: 0.75rem;
    background-image:
      linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
    background-size: 20px 20px;
    pointer-events: none;
    z-index: 11;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .blog-card:hover .card-grid-overlay {
    opacity: 1;
  }

  /* Mouse-following glow effect */
  .glow-overlay {
    position: absolute;
    inset: 0;
    border-radius: 0.75rem;
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
    z-index: 50;
    background: radial-gradient(
      600px circle at var(--mouse-x, 50%) var(--mouse-y, 50%),
      rgba(255, 102, 0, 0.2),
      rgba(255, 170, 68, 0.15),
      rgba(255, 68, 68, 0.08),
      transparent 40%
    );
    mix-blend-mode: screen;
    will-change: opacity;
  }

  .blog-card:hover .glow-overlay {
    opacity: 1;
  }

  /* Enhanced card content hover */
  .card-content {
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.05), 0 10px 30px rgba(0, 0, 0, 0.5);
  }

  .blog-card:hover .card-content {
    border-color: rgba(255, 255, 255, 0.3);
    box-shadow:
      inset 0 1px 0 rgba(255, 255, 255, 0.1),
      0 20px 40px rgba(0, 0, 0, 0.6),
      0 0 40px rgba(0, 255, 255, 0.1),
      0 0 80px rgba(255, 0, 255, 0.1);
  }

  /* ===== TABLE OF CONTENTS ===== */

  .toc-container {
    padding: 1.25rem;
    border-radius: 12px;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.02) 0%, rgba(255, 255, 255, 0.05) 100%);
    border: 1px solid rgba(255, 255, 255, 0.08);
    backdrop-filter: blur(10px);
  }

  .toc-icon {
    padding: 0.5rem;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    border: 1px solid rgba(255, 255, 255, 0.1);
  }

  .toc-item {
    display: inline-flex;
    align-items: center;
    padding: 0.5rem 0.875rem;
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 9999px;
    font-size: 0.8125rem;
    color: rgba(255, 255, 255, 0.7);
    cursor: pointer;
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
  }

  .toc-item::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
    transform: translateX(-100%);
    transition: transform 0.5s ease;
  }

  .toc-item:hover::before {
    transform: translateX(100%);
  }

  .toc-item:hover {
    background: rgba(255, 255, 255, 0.08);
    border-color: rgba(255, 255, 255, 0.25);
    color: rgba(255, 255, 255, 0.95);
    transform: translateY(-2px);
    box-shadow:
      0 4px 12px rgba(0, 0, 0, 0.3),
      0 0 20px rgba(0, 255, 255, 0.1);
  }

  .toc-item:hover .toc-number {
    color: rgba(0, 255, 255, 0.7);
  }

  .toc-title {
    white-space: normal;
    word-break: break-word;
  }

  .toc-status-dot {
    width: 6px;
    height: 6px;
    background: #22c55e;
    border-radius: 50%;
    margin-left: 0.5rem;
    flex-shrink: 0;
    box-shadow: 0 0 8px rgba(34, 197, 94, 0.5);
    animation: pulse-dot 2s ease-in-out infinite;
  }

  @keyframes pulse-dot {
    0%, 100% {
      opacity: 1;
      transform: scale(1);
    }
    50% {
      opacity: 0.7;
      transform: scale(1.2);
    }
  }

  .toc-item.active {
    background: rgba(0, 255, 255, 0.1);
    border-color: rgba(0, 255, 255, 0.4);
    color: #fff;
  }

  .toc-item.active .toc-number {
    color: rgba(0, 255, 255, 0.9);
  }

  /* Highlight animation when TOC item is clicked */
  .toc-highlight {
    animation: tocHighlight 2s ease-out;
  }

  @keyframes tocHighlight {
    0% {
      box-shadow:
        0 0 0 2px rgba(0, 255, 255, 0.8),
        0 0 30px rgba(0, 255, 255, 0.4),
        0 0 60px rgba(0, 255, 255, 0.2);
    }
    50% {
      box-shadow:
        0 0 0 3px rgba(0, 255, 255, 0.5),
        0 0 40px rgba(0, 255, 255, 0.3),
        0 0 80px rgba(0, 255, 255, 0.1);
    }
    100% {
      box-shadow: none;
    }
  }

  .toc-highlight .card-content {
    border-color: rgba(0, 255, 255, 0.5) !important;
  }

  /* ===== SCROLL INDICATOR ===== */
  .scroll-indicator {
    opacity: 0;
    animation: fadeInUp 1s ease-out forwards, floatUpDown 2s ease-in-out infinite;
    animation-delay: 1.2s, 1.2s;
  }

  .scroll-arrow {
    animation: bounceDown 1.5s ease-in-out infinite;
  }

  @keyframes bounceDown {
    0%, 100% {
      transform: translateY(0);
    }
    50% {
      transform: translateY(8px);
    }
  }

  @keyframes floatUpDown {
    0%, 100% {
      transform: translateX(-50%) translateY(0);
    }
    50% {
      transform: translateX(-50%) translateY(-5px);
    }
  }

  /* Hide scroll indicator when scrolled or mouse active */
  .hero-section.mouse-active .scroll-indicator {
    opacity: 0 !important;
    transition: opacity 0.3s ease-out;
  }

  /* ===== RESPONSIVE DESIGN ===== */

  @media (max-width: 1024px) {
    .hero-name {
      font-size: clamp(1.8rem, 8vw, 10rem);
      letter-spacing: -0.04em;
    }
  }

  @media (max-width: 768px) {
    .hero-name {
      font-size: clamp(1.5rem, 7.5vw, 8rem);
      letter-spacing: -0.03em;
    }

    .statement-text {
      font-size: clamp(0.9rem, 3vw, 1.25rem);
    }

    .hero-section.mouse-active .hero-content {
      opacity: 0.08;
    }
  }

  @media (max-width: 640px) {
    .hero-name {
      font-size: clamp(1.2rem, 9vw, 5rem);
      letter-spacing: -0.02em;
    }

    .label-intro span {
      font-size: 0.65rem;
      letter-spacing: 0.2em;
    }

    .cta-primary {
      width: 100%;
    }

    .robot-overlay {
      background: rgba(0, 0, 0, 0.96) !important;
    }

    .hero-section.mouse-active .hero-content {
      opacity: 0.05;
    }

    .hero-section.mouse-active .robot-overlay {
      background: rgba(0, 0, 0, 0.2) !important;
    }

    .card-corner-accent {
      width: 15px;
      height: 15px;
    }

    .blog-card:hover .card-corner-accent {
      width: 20px;
      height: 20px;
    }

    .toc-container {
      padding: 1rem;
    }

    .toc-item {
      padding: 0.4rem 0.75rem;
      font-size: 0.75rem;
    }
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const heroSection = document.getElementById("hero-section");
    const robotContainer = document.getElementById("robot-container");

    let mouseActive = false;
    let mouseTimeout: number | null = null;

    // ===== DUAL HOVER/TOUCH ANIMATION =====
    const handleInteraction = (clientX: number, clientY: number) => {
      const rect = heroSection!.getBoundingClientRect();

      const mouseX = (clientX - rect.left) / rect.width;
      const mouseY = (clientY - rect.top) / rect.height;

      if (!mouseActive) {
        heroSection!.classList.add('mouse-active');
        mouseActive = true;
      }

      if (mouseTimeout) {
        clearTimeout(mouseTimeout);
      }

      // Dispatch position to THREE.js keyboard viewer
      document.dispatchEvent(
        new CustomEvent("blogKeyboardMouseMove", {
          detail: {
            x: mouseX,
            y: mouseY,
            clientX: clientX,
            clientY: clientY
          },
        })
      );

      mouseTimeout = window.setTimeout(() => {
        heroSection!.classList.remove('mouse-active');
        mouseActive = false;

        document.dispatchEvent(
          new CustomEvent("blogKeyboardMouseInactive", {
            detail: { inactive: true },
          })
        );
      }, 800);
    };

    if (heroSection && robotContainer) {
      heroSection.addEventListener("mousemove", (e) => {
        handleInteraction(e.clientX, e.clientY);
      });

      heroSection.addEventListener("touchmove", (e) => {
        e.preventDefault();
        if (e.touches.length > 0) {
          const touch = e.touches[0];
          handleInteraction(touch.clientX, touch.clientY);
        }
      }, { passive: false });

      heroSection.addEventListener("touchstart", (e) => {
        if (e.touches.length > 0) {
          const touch = e.touches[0];
          handleInteraction(touch.clientX, touch.clientY);
        }
      });

      heroSection.addEventListener("touchend", () => {
        heroSection.classList.remove('mouse-active');
        mouseActive = false;

        if (mouseTimeout) {
          clearTimeout(mouseTimeout);
          mouseTimeout = null;
        }

        document.dispatchEvent(
          new CustomEvent("blogKeyboardMouseLeave", {
            detail: { left: true },
          })
        );
      });

      heroSection.addEventListener("mouseleave", () => {
        heroSection.classList.remove('mouse-active');
        mouseActive = false;

        if (mouseTimeout) {
          clearTimeout(mouseTimeout);
          mouseTimeout = null;
        }

        document.dispatchEvent(
          new CustomEvent("blogKeyboardMouseLeave", {
            detail: { left: true },
          })
        );
      });

      heroSection.addEventListener("mouseenter", () => {
        document.dispatchEvent(
          new CustomEvent("blogKeyboardMouseEnter", {
            detail: { entered: true },
          })
        );
      });
    }

    // ===== PARALLAX EFFECT ON SCROLL =====
    let ticking = false;
    window.addEventListener("scroll", () => {
      if (!ticking) {
        window.requestAnimationFrame(() => {
          const scrolled = window.scrollY;
          const heroContent = document.querySelector(".hero-content");

          if (heroContent && scrolled < window.innerHeight) {
            const opacity = Math.max(0, 1 - scrolled / (window.innerHeight * 0.7));
            const translateY = scrolled * 0.3;
            (heroContent as HTMLElement).style.opacity = opacity.toString();
            (heroContent as HTMLElement).style.transform = `translateY(${translateY}px)`;
          }

          ticking = false;
        });
        ticking = true;
      }
    });

    // ===== BLOG CARD GLOW EFFECT =====
    const blogCards = document.querySelectorAll<HTMLElement>('.blog-card');

    blogCards.forEach((card) => {
      const glowOverlay = card.querySelector<HTMLElement>('.glow-overlay');
      if (!glowOverlay) return;

      card.addEventListener('mousemove', (e) => {
        const rect = card.getBoundingClientRect();
        const x = ((e.clientX - rect.left) / rect.width) * 100;
        const y = ((e.clientY - rect.top) / rect.height) * 100;

        glowOverlay.style.setProperty('--mouse-x', `${x}%`);
        glowOverlay.style.setProperty('--mouse-y', `${y}%`);
      });

      card.addEventListener('mouseleave', () => {
        glowOverlay.style.setProperty('--mouse-x', '50%');
        glowOverlay.style.setProperty('--mouse-y', '50%');
      });
    });

    // ===== SEARCH FUNCTIONALITY =====
    const searchInput = document.getElementById('searchInput') as HTMLInputElement;
    const blogGrid = document.getElementById('blogGrid') as HTMLElement;
    const searchStatus = document.getElementById('searchStatus') as HTMLElement;

    if (searchInput && blogGrid && searchStatus) {
      searchInput.addEventListener('input', () => {
        const searchTerm = searchInput.value.toLowerCase().trim();
        let matchCount = 0;

        blogCards.forEach((card: HTMLElement) => {
          const titleElement = card.querySelector('h2');
          const descriptionElement = card.querySelector('p.text-primary\\/80');
          const tagElements = card.querySelectorAll('.mt-4 span');

          if (!titleElement || !descriptionElement) return;

          const title = titleElement.textContent?.toLowerCase() || '';
          const description = descriptionElement.textContent?.toLowerCase() || '';
          const tags = Array.from(tagElements).map(tag => tag.textContent?.toLowerCase() || '');

          const matchesSearch =
            title.includes(searchTerm) ||
            description.includes(searchTerm) ||
            tags.some(tag => tag.includes(searchTerm));

          if (matchesSearch || searchTerm === '') {
            card.classList.remove('hidden');
            matchCount++;
          } else {
            card.classList.add('hidden');
          }
        });

        if (searchTerm !== '') {
          searchStatus.classList.remove('hidden');
          searchStatus.textContent = `Found ${matchCount} article${matchCount !== 1 ? 's' : ''}`;
        } else {
          searchStatus.classList.add('hidden');
        }

        const emptyStateEl = document.getElementById('emptyState');
        if (matchCount === 0 && searchTerm !== '') {
          if (!emptyStateEl) {
            const emptyState = document.createElement('div');
            emptyState.id = 'emptyState';
            emptyState.className = 'col-span-1 sm:col-span-2 lg:col-span-3 text-center py-12';
            emptyState.innerHTML = `
              <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto text-primary/30" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <p class="mt-4 text-lg text-primary/70">No articles found matching "${searchTerm}"</p>
              <button id="clearSearch" class="mt-2 text-primary hover:text-primary/80 underline">Clear search</button>
            `;
            blogGrid.appendChild(emptyState);

            const clearButton = document.getElementById('clearSearch');
            if (clearButton) {
              clearButton.addEventListener('click', () => {
                searchInput.value = '';
                searchInput.dispatchEvent(new Event('input'));
              });
            }
          }
        } else if (emptyStateEl) {
          emptyStateEl.remove();
        }
      });
    }

    // ===== TABLE OF CONTENTS =====
    const tocItems = document.querySelectorAll<HTMLButtonElement>('.toc-item');
    const blogCardsArray = Array.from(blogCards);

    tocItems.forEach((tocItem) => {
      tocItem.addEventListener('click', () => {
        const index = parseInt(tocItem.dataset.index || '0', 10);
        const targetCard = blogCardsArray[index];

        if (targetCard) {
          tocItems.forEach(item => item.classList.remove('active'));
          tocItem.classList.add('active');

          const cardRect = targetCard.getBoundingClientRect();
          const offset = 100;
          const scrollTo = window.scrollY + cardRect.top - offset;

          window.scrollTo({
            top: scrollTo,
            behavior: 'smooth'
          });

          targetCard.classList.add('toc-highlight');
          setTimeout(() => {
            targetCard.classList.remove('toc-highlight');
          }, 2000);
        }
      });
    });

    // Update active TOC item on scroll
    if ('IntersectionObserver' in window) {
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const cardIndex = blogCardsArray.indexOf(entry.target as HTMLElement);
            if (cardIndex !== -1) {
              tocItems.forEach((item, i) => {
                if (i === cardIndex) {
                  item.classList.add('active');
                } else {
                  item.classList.remove('active');
                }
              });
            }
          }
        });
      }, {
        rootMargin: '-20% 0px -60% 0px',
        threshold: 0
      });

      blogCardsArray.forEach(card => observer.observe(card));
    }
  });
</script>
