---
import { getCollection, getEntry } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import Navbar from '../../layouts/Navigation.astro';
import Footer from '../../layouts/Footer.astro';
import { Image } from 'astro:assets';

export async function getStaticPaths() {
  const experiences = await getCollection('experience');
  return experiences.map(experience => ({
    params: { slug: experience.slug },
  }));
}

const { slug } = Astro.params;
const experience = await getEntry('experience', slug);
const { Content } = await experience.render();
---

<Layout title={`${experience.data.title} | Rohan Singh`}>
  <div class="min-h-screen flex flex-col">
    <div class="flex-grow">
      <Navbar>
        <div class="sm:px-20 px-6 py-8">
          <article class="prose prose-lg dark:prose-invert max-w-4xl mx-auto">
            <header class="mb-8">
              <div class="flex flex-col md:flex-row md:items-center gap-4 mb-4">
                <h1 class="m-0">{experience.data.title}</h1>
                <span class="text-primary/60 font-mono">
                  {experience.data.company}
                </span>
              </div>

              <div class="flex items-center gap-4 text-primary/60 font-mono">
                <time datetime={experience.data.date}>
                  {new Date(experience.data.date).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long'
                  })}
                </time>
                {experience.data.endDate && (
                  <>
                    <span>→</span>
                    <time datetime={experience.data.endDate}>
                      {new Date(experience.data.endDate).toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'long'
                      })}
                    </time>
                  </>
                )}
                <span>•</span>
                <span>{experience.data.location}</span>
              </div>

              <div class="flex flex-wrap gap-2 mt-4">
                {experience.data.tags.map((tag: string) => (
                  <span class="text-sm text-primary/60 font-mono">{tag}</span>
                ))}
              </div>
            </header>
            
            <div class="markdown-content">
              <Content />
            </div>

            {experience.data.images && (
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8">
                {experience.data.images.map((image: { src: string; alt: string }) => (
                  <img
                    src={image.src}
                    alt={image.alt}
                    class="w-full rounded-lg border border-primary/20"
                  />
                ))}
              </div>
            )}
          </article>
        </div>
      </Navbar>
    </div>
    <Footer />
  </div>
</Layout> 