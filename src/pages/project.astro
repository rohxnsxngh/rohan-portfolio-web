---
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";
import Layout from "../layouts/Layout.astro";
import Navbar from "../layouts/Navigation.astro";
import Footer from "../layouts/Footer.astro";
import ProjectImage from "../components/ProjectImage.astro";
import HeavyRobotModelViewer from "../components/HeavyRobotModelViewer.astro";

// Get all projects with error handling
let allProjects: CollectionEntry<"project">[] = [];
try {
  allProjects = await getCollection("project");
} catch (error) {
  // Silently handle error - empty projects array will be used
}

// Make sure we have valid projects by removing any undefined entries
const validProjects = allProjects.filter(
  (project) => project && project.data && project.data.title
);

// Sort projects by status with fallback values
const sortedProjects = [...validProjects].sort((a, b) => {
  // Default status if missing
  const statusA = a.data?.status || "completed";
  const statusB = b.data?.status || "completed";

  // Sort by status (completed first, then in-progress, then coming-soon)
  const statusOrder = { completed: 0, "in-progress": 1, "coming-soon": 2 };
  const statusCompare =
    (statusOrder[statusA] || 0) - (statusOrder[statusB] || 0);

  // If same status, sort by date (newest first)
  if (statusCompare === 0) {
    const dateA = new Date(a.data?.date || 0).getTime();
    const dateB = new Date(b.data?.date || 0).getTime();
    return dateB - dateA;
  }

  return statusCompare;
});
---

<Layout>
  <Navbar>
    <!-- HERO SECTION - Full page robot background like homepage -->
    <div
      class="hero-section relative min-h-screen bg-secondary flex items-center justify-center overflow-hidden"
      id="hero-section"
    >
      <!-- FULL PAGE ROBOT BACKGROUND -->
      <div class="robot-background-container absolute inset-0 z-0" id="robot-container">
        <div class="robot-frame-fullscreen w-full h-full">
          <div class="w-full h-full robot-viewer" id="robot-viewer">
            <HeavyRobotModelViewer />
          </div>
        </div>

        <!-- Dark overlay to dim robot heavily by default -->
        <div class="robot-overlay absolute inset-0 bg-black/[0.98] pointer-events-none transition-all duration-500" id="robot-dim"></div>
      </div>

      <!-- Tech grid overlay for texture -->
      <div class="absolute inset-0 tech-grid opacity-10 z-[5] pointer-events-none"></div>

      <!-- Main content - layered on top -->
      <div class="hero-content relative z-10 w-full px-4 sm:px-6 lg:px-8 pointer-events-none transition-opacity duration-300" id="hero-content">
        <div class="max-w-7xl mx-auto">
          <!-- Small intro label -->
          <div class="label-intro mb-6 sm:mb-8">
            <span class="text-primary/50 font-mono text-xs sm:text-sm tracking-[0.3em] uppercase">
              Software • Robotics • AI
            </span>
          </div>

          <!-- MASSIVE title display -->
          <div class="name-display mb-6 sm:mb-10">
            <h1 class="hero-name font-mono font-black tracking-tighter leading-none select-none">
              <div class="name-line">
                <span class="char char-1">P</span><span class="char char-2">R</span><span class="char char-3">O</span><span class="char char-4">J</span><span class="char char-5">E</span><span class="char char-6">C</span><span class="char char-7">T</span><span class="char char-8">S</span>
              </div>
            </h1>
          </div>

          <!-- Bold statement -->
          <div class="statement mb-8 sm:mb-12 max-w-4xl">
            <p class="statement-text text-primary/60 font-mono tracking-wide leading-relaxed">
              A showcase of my <span class="highlight">digital workshop</span>
            </p>
          </div>

          <!-- CTA Section -->
          <div class="cta-section flex flex-col sm:flex-row gap-4 sm:gap-6 items-start sm:items-center pointer-events-auto">
            <a
              href="#projects-display"
              class="cta-primary group relative inline-flex items-center justify-center px-7 py-3 bg-primary text-secondary font-mono text-sm sm:text-base tracking-wider font-bold overflow-hidden transition-all duration-300 hover:scale-105 hover:shadow-2xl hover:shadow-primary/40"
            >
              <span class="relative z-10">VIEW PROJECTS</span>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-5 w-5 ml-3 group-hover:translate-y-1 transition-transform relative z-10"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2.5"
                  d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
              </svg>
              <div class="cta-shine"></div>
            </a>

            <a
              href="/"
              class="cta-secondary group inline-flex items-center text-primary/70 hover:text-primary font-mono text-sm sm:text-base tracking-wider transition-all duration-300"
            >
              Back to home
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-4 w-4 ml-2 group-hover:-translate-x-1 transition-transform"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M7 16l-4-4m0 0l4-4m-4 4h18"></path>
              </svg>
            </a>
          </div>
        </div>
      </div>

      <!-- Scroll Indicator -->
      <div class="scroll-indicator absolute bottom-8 left-1/2 -translate-x-1/2 z-20 pointer-events-none">
        <div class="scroll-content flex flex-col items-center gap-2">
          <span class="text-primary/40 font-mono text-xs tracking-widest uppercase">Scroll</span>
          <div class="scroll-arrow">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-primary/40" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
            </svg>
          </div>
        </div>
      </div>
    </div>

    <!-- PROJECTS SECTION -->
    <div class="relative bg-secondary" id="projects-display">
      <!-- Tech grid overlay -->
      <div class="absolute inset-0 tech-grid opacity-10 z-0 pointer-events-none"></div>

      <div class="relative z-10 sm:px-20 px-6 py-16">
        <!-- Section header -->
        <div class="mb-12">
          <div class="flex flex-wrap justify-center gap-3 text-xs mb-8">
            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-500/10 text-green-400 border border-green-500/20">
              <span class="w-2 h-2 rounded-full bg-green-400 mr-2"></span>Completed
            </span>
            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-500/10 text-blue-400 border border-blue-500/20">
              <span class="w-2 h-2 rounded-full bg-blue-400 mr-2"></span>In Progress
            </span>
            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-purple-500/10 text-purple-400 border border-purple-500/20">
              <span class="w-2 h-2 rounded-full bg-purple-400 mr-2"></span>Coming Soon
            </span>
          </div>
        </div>

        <!-- Project grid layout -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {
            sortedProjects.length > 0 ? (
              sortedProjects.map((project) => {
                try {
                  // Default values for missing data
                  const title = project.data?.title || "Untitled Project";
                  const description =
                    project.data?.description || "No description available";
                  const status = project.data?.status || "completed";
                  const date = project.data?.date || new Date().toISOString();
                  const tags = Array.isArray(project.data?.tags)
                    ? project.data.tags
                    : [];
                  const github = project.data?.github || "";
                  const demo = project.data?.demo || "";
                  const kaggle = project.data?.kaggle || "";
                  const image = project.data?.image || "";

                  const statusColors = {
                    completed: "bg-green-500/10 text-green-400",
                    "in-progress": "bg-blue-500/10 text-blue-400",
                    "coming-soon": "bg-purple-500/10 text-purple-400",
                  };

                  const statusText = {
                    completed: "Completed",
                    "in-progress": "In Progress",
                    "coming-soon": "Coming Soon",
                  };

                  // Use default color if status is not recognized
                  const statusColor =
                    statusColors[status] || "bg-gray-500/10 text-gray-400";
                  const statusDisplay = statusText[status] || "Unknown";

                  return (
                    <div class="relative z-1 project-card group">
                      <!-- Corner accent marks -->
                      <div class="card-corner-accent card-corner-tl"></div>
                      <div class="card-corner-accent card-corner-tr"></div>
                      <div class="card-corner-accent card-corner-bl"></div>
                      <div class="card-corner-accent card-corner-br"></div>

                      <!-- Animated gradient border -->
                      <div class="card-gradient-border"></div>

                      <!-- Grid overlay -->
                      <div class="card-grid-overlay"></div>

                      <!-- Glow overlay that follows mouse -->
                      <div class="glow-overlay"></div>

                      <div class="card-content h-full min-h-[200px] rounded-xl bg-black border border-accent/20 transition-all duration-300 hover:shadow-lg flex flex-col relative z-10">
                        {/* Add the ProjectImage component here */}
                        <ProjectImage image={image} title={title} tags={tags} />

                        <div class="p-6">
                          <div class="flex items-center justify-between mb-3">
                            <a
                              href={`/project/${project.slug}`}
                              class="text-xl font-bold text-white hover:text-primary/90 transition-colors"
                            >
                              {title}
                            </a>
                            <span
                              class={`px-2 py-1 text-xs rounded-full flex-shrink-0 ${statusColor}`}
                            >
                              {statusDisplay}
                            </span>
                          </div>
                          <p class="text-sm text-white/60 mb-4">
                            {new Date(date).toLocaleDateString("en-US", {
                              year: "numeric",
                              month: "long",
                            })}
                          </p>
                          <p class="text-white/80 flex-grow line-clamp-3">
                            {description}
                          </p>
                          <div class="mt-4 flex flex-wrap gap-2">
                            {tags.slice(0, 3).map((tag) => (
                              <span class="text-sm px-3 py-1 rounded-lg bg-accent/20 text-white/90 border border-accent/30 hover:bg-accent/30 transition-colors duration-200">
                                {tag}
                              </span>
                            ))}
                            {tags.length > 3 && (
                              <span class="text-sm px-3 py-1 rounded-lg bg-accent/10 text-white/70">
                                +{tags.length - 3} more
                              </span>
                            )}
                          </div>
                          {(github || demo || kaggle) && (
                            <div class="mt-4 pt-4 flex gap-4 border-t border-accent/10">
                              {github && (
                                <a
                                  href={github}
                                  target="_blank"
                                  rel="noopener noreferrer"
                                  class="text-sm text-white/80 hover:text-white transition-colors"
                                  onclick="arguments[0].stopPropagation()"
                                >
                                  GitHub →
                                </a>
                              )}
                              {demo && (
                                <a
                                  href={demo}
                                  target="_blank"
                                  rel="noopener noreferrer"
                                  class="text-sm text-white/80 hover:text-white transition-colors ml-4"
                                  onclick="arguments[0].stopPropagation()"
                                >
                                  Live Demo →
                                </a>
                              )}
                              {kaggle && (
                                <a
                                  href={kaggle}
                                  target="_blank"
                                  rel="noopener noreferrer"
                                  class="text-sm text-white/80 hover:text-white transition-colors ml-4"
                                  onclick="arguments[0].stopPropagation()"
                                >
                                  Kaggle Challenge →
                                </a>
                              )}
                            </div>
                          )}
                        </div>
                      </div>
                      <a
                        href={`/project/${project.slug}`}
                        class="absolute inset-0 z-20"
                        aria-hidden="true"
                      />
                    </div>
                  );
                } catch {
                  return (
                    <div class="bg-red-500/20 p-4 rounded-xl text-white">
                      Error rendering project
                    </div>
                  );
                }
              })
            ) : (
              <div class="col-span-3 text-center py-8 bg-base-200/30 rounded-xl">
                <p class="text-white/80">
                  No projects found. Check your content collection.
                </p>
              </div>
            )
          }
        </div>
      </div>
    </div>
  </Navbar>
  <Footer />
</Layout>

<style>
  /* ===== HERO SECTION STYLES (matching homepage) ===== */

  /* Tech grid background */
  .tech-grid {
    background-image:
      linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
    background-size: 100px 100px;
    animation: gridPan 60s linear infinite;
  }

  @keyframes gridPan {
    0% { background-position: 0 0; }
    100% { background-position: 100px 100px; }
  }

  /* ===== MASSIVE TYPOGRAPHY ===== */
  .hero-name {
    font-size: clamp(2.5rem, 11vw, 16rem);
    line-height: 0.85;
    letter-spacing: -0.06em;
    color: #ffffff;
    text-transform: uppercase;
    font-weight: 900;
    -webkit-text-stroke: 1px rgba(255, 255, 255, 0.3);
    white-space: nowrap;
  }

  .hero-name .name-line {
    display: block;
    position: relative;
  }

  /* Individual character animations */
  .hero-name .char {
    display: inline-block;
    opacity: 0;
    transform: translateY(100px) scale(0.8);
    animation: charReveal 1s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    text-shadow:
      0 0 40px rgba(255, 255, 255, 0.1),
      0 10px 30px rgba(0, 0, 0, 0.5);
  }

  /* Staggered animation delays */
  .char-1 { animation-delay: 0.05s; }
  .char-2 { animation-delay: 0.10s; }
  .char-3 { animation-delay: 0.15s; }
  .char-4 { animation-delay: 0.20s; }
  .char-5 { animation-delay: 0.25s; }
  .char-6 { animation-delay: 0.30s; }
  .char-7 { animation-delay: 0.35s; }
  .char-8 { animation-delay: 0.40s; }

  @keyframes charReveal {
    0% {
      opacity: 0;
      transform: translateY(100px) scale(0.8);
    }
    60% {
      transform: translateY(-10px) scale(1.02);
    }
    100% {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }

  /* Label intro animation */
  .label-intro {
    opacity: 0;
    animation: fadeInDown 0.8s ease-out forwards;
  }

  @keyframes fadeInDown {
    from {
      opacity: 0;
      transform: translateY(-20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Statement text */
  .statement {
    opacity: 0;
    animation: fadeInUp 1s ease-out forwards;
    animation-delay: 0.5s;
  }

  .statement-text {
    font-size: clamp(1rem, 2.5vw, 1.5rem);
    line-height: 1.6;
  }

  .highlight {
    color: #ffffff;
    font-weight: 700;
    position: relative;
  }

  .highlight::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 2px;
    background: linear-gradient(90deg, rgba(255, 255, 255, 0.5), transparent);
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* CTA Section */
  .cta-section {
    opacity: 0;
    animation: fadeInUp 1s ease-out forwards;
    animation-delay: 0.7s;
  }

  /* Primary CTA Button */
  .cta-primary {
    position: relative;
    clip-path: polygon(0 0, 100% 0, 100% 100%, 0 100%);
  }

  .cta-shine {
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    transition: left 0.7s;
  }

  .cta-primary:hover .cta-shine {
    left: 100%;
  }

  /* Secondary CTA */
  .cta-secondary {
    text-decoration: underline;
    text-decoration-color: rgba(255, 255, 255, 0.2);
    text-underline-offset: 6px;
    text-decoration-thickness: 1px;
  }

  .cta-secondary:hover {
    text-decoration-color: rgba(255, 255, 255, 0.6);
  }

  /* ===== ROBOT AS FULL BACKGROUND ===== */

  .robot-background-container {
    opacity: 1;
  }

  .robot-frame-fullscreen {
    position: absolute;
    inset: 0;
  }

  /* Robot overlay - dims the robot heavily, lightens on hover */
  .robot-overlay {
    z-index: 1;
    transition: background 0.6s ease-out;
  }

  /* Hero content with slower fade transitions */
  .hero-content {
    opacity: 1;
    transition: opacity 0.5s ease-out;
  }

  /* Typography with enhanced text shadow for readability */
  .hero-name {
    text-shadow:
      0 3px 25px rgba(0, 0, 0, 0.9),
      0 6px 45px rgba(0, 0, 0, 0.7),
      0 0 80px rgba(0, 0, 0, 0.5);
  }

  .statement-text,
  .label-intro span {
    text-shadow:
      0 2px 15px rgba(0, 0, 0, 0.95),
      0 4px 25px rgba(0, 0, 0, 0.8);
  }

  /* Mouse interaction states */
  .hero-section.mouse-active .hero-content {
    opacity: 0.05;
    transition: opacity 0.6s ease-out;
  }

  .hero-section.mouse-active .robot-overlay {
    background: rgba(0, 0, 0, 0.2) !important;
  }

  /* When mouse becomes inactive, fade back slowly */
  .hero-section:not(.mouse-active) .hero-content {
    transition: opacity 2s ease-in-out;
  }

  .hero-section:not(.mouse-active) .robot-overlay {
    transition: background 2.5s ease-in-out;
  }

  /* Prevent layout shift */
  .hero-section {
    min-height: 100vh;
    min-height: 100dvh;
  }

  /* ===== PROJECT CARDS ===== */

  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .project-card {
    transition: transform 0.3s ease-out;
    overflow: hidden;
    border-radius: 0.75rem;
  }

  .project-card:hover {
    transform: translateY(-4px);
  }

  /* Corner accent marks */
  .card-corner-accent {
    position: absolute;
    width: 20px;
    height: 20px;
    border: 2px solid rgba(255, 255, 255, 0.4);
    z-index: 15;
    pointer-events: none;
    transition: all 0.3s ease;
    opacity: 1;
  }

  .card-corner-tl {
    top: -1px;
    left: -1px;
    border-right: none;
    border-bottom: none;
    border-radius: 12px 0 0 0;
  }

  .card-corner-tr {
    top: -1px;
    right: -1px;
    border-left: none;
    border-bottom: none;
    border-radius: 0 12px 0 0;
  }

  .card-corner-bl {
    bottom: -1px;
    left: -1px;
    border-right: none;
    border-top: none;
    border-radius: 0 0 0 12px;
  }

  .card-corner-br {
    bottom: -1px;
    right: -1px;
    border-left: none;
    border-top: none;
    border-radius: 0 0 12px 0;
  }

  .project-card:hover .card-corner-accent {
    width: 30px;
    height: 30px;
    border-color: rgba(255, 255, 255, 0.8);
    filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.5));
  }

  /* Animated gradient border */
  .card-gradient-border {
    position: absolute;
    inset: -2px;
    border-radius: 0.75rem;
    padding: 2px;
    background: linear-gradient(
      45deg,
      transparent,
      rgba(0, 255, 255, 0.3),
      transparent,
      rgba(255, 0, 255, 0.3),
      transparent
    );
    background-size: 200% 200%;
    -webkit-mask:
      linear-gradient(#fff 0 0) content-box,
      linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
    animation: borderGlow 4s linear infinite;
    opacity: 0.6;
    pointer-events: none;
    z-index: 5;
  }

  @keyframes borderGlow {
    0%, 100% {
      background-position: 0% 50%;
    }
    50% {
      background-position: 100% 50%;
    }
  }

  .project-card:hover .card-gradient-border {
    opacity: 1;
    animation-duration: 2s;
  }

  /* Grid overlay */
  .card-grid-overlay {
    position: absolute;
    inset: 0;
    border-radius: 0.75rem;
    background-image:
      linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
    background-size: 20px 20px;
    pointer-events: none;
    z-index: 11;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .project-card:hover .card-grid-overlay {
    opacity: 1;
  }

  /* Mouse-following glow effect */
  .glow-overlay {
    position: absolute;
    inset: 0;
    border-radius: 0.75rem;
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
    z-index: 50;
    background: radial-gradient(
      600px circle at var(--mouse-x, 50%) var(--mouse-y, 50%),
      rgba(255, 102, 0, 0.2),
      rgba(255, 170, 68, 0.15),
      rgba(255, 68, 68, 0.08),
      transparent 40%
    );
    mix-blend-mode: screen;
    will-change: opacity;
  }

  .project-card:hover .glow-overlay {
    opacity: 1;
  }

  /* Enhanced card content hover */
  .card-content {
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.05), 0 10px 30px rgba(0, 0, 0, 0.5);
    overflow: hidden;
  }

  .project-card:hover .card-content {
    border-color: rgba(255, 255, 255, 0.3);
    box-shadow:
      inset 0 1px 0 rgba(255, 255, 255, 0.1),
      0 20px 40px rgba(0, 0, 0, 0.6),
      0 0 40px rgba(0, 255, 255, 0.1),
      0 0 80px rgba(255, 0, 255, 0.1);
  }

  /* ===== SCROLL INDICATOR ===== */
  .scroll-indicator {
    opacity: 0;
    animation: fadeInUp 1s ease-out forwards, floatUpDown 2s ease-in-out infinite;
    animation-delay: 1.2s, 1.2s;
  }

  .scroll-arrow {
    animation: bounceDown 1.5s ease-in-out infinite;
  }

  @keyframes bounceDown {
    0%, 100% {
      transform: translateY(0);
    }
    50% {
      transform: translateY(8px);
    }
  }

  @keyframes floatUpDown {
    0%, 100% {
      transform: translateX(-50%) translateY(0);
    }
    50% {
      transform: translateX(-50%) translateY(-5px);
    }
  }

  /* Hide scroll indicator when scrolled or mouse active */
  .hero-section.mouse-active .scroll-indicator {
    opacity: 0 !important;
    transition: opacity 0.3s ease-out;
  }

  /* ===== RESPONSIVE DESIGN ===== */

  @media (max-width: 1024px) {
    .hero-name {
      font-size: clamp(2rem, 10vw, 12rem);
      letter-spacing: -0.05em;
    }
  }

  @media (max-width: 768px) {
    .hero-name {
      font-size: clamp(1.8rem, 9vw, 8rem);
      letter-spacing: -0.04em;
    }

    .statement-text {
      font-size: clamp(0.9rem, 3vw, 1.25rem);
    }

    .hero-section.mouse-active .hero-content {
      opacity: 0.08;
    }
  }

  @media (max-width: 640px) {
    .hero-name {
      font-size: clamp(1.5rem, 11vw, 6rem);
      letter-spacing: -0.03em;
    }

    .label-intro span {
      font-size: 0.65rem;
      letter-spacing: 0.2em;
    }

    .cta-primary {
      width: 100%;
    }

    .robot-overlay {
      background: rgba(0, 0, 0, 0.96) !important;
    }

    .hero-section.mouse-active .hero-content {
      opacity: 0.05;
    }

    .hero-section.mouse-active .robot-overlay {
      background: rgba(0, 0, 0, 0.2) !important;
    }

    .card-corner-accent {
      width: 15px;
      height: 15px;
    }

    .project-card:hover .card-corner-accent {
      width: 20px;
      height: 20px;
    }
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const heroSection = document.getElementById("hero-section");
    const robotContainer = document.getElementById("robot-container");

    let mouseActive = false;
    let mouseTimeout: number | null = null;

    // ===== DUAL HOVER/TOUCH ANIMATION =====
    const handleInteraction = (clientX: number, clientY: number) => {
      const rect = heroSection!.getBoundingClientRect();

      // Calculate position (0 to 1 normalized coordinates)
      const mouseX = (clientX - rect.left) / rect.width;
      const mouseY = (clientY - rect.top) / rect.height;

      // Activate hover state (fade typography, lighten robot overlay)
      if (!mouseActive) {
        heroSection!.classList.add('mouse-active');
        mouseActive = true;
      }

      // Clear existing timeout
      if (mouseTimeout) {
        clearTimeout(mouseTimeout);
      }

      // Dispatch position to THREE.js robot viewer
      document.dispatchEvent(
        new CustomEvent("projectsRobotMouseMove", {
          detail: {
            x: mouseX,
            y: mouseY,
            clientX: clientX,
            clientY: clientY
          },
        })
      );

      // Reset to inactive state after interaction stops
      mouseTimeout = window.setTimeout(() => {
        heroSection!.classList.remove('mouse-active');
        mouseActive = false;

        document.dispatchEvent(
          new CustomEvent("projectsRobotMouseInactive", {
            detail: { inactive: true },
          })
        );
      }, 800);
    };

    // Track mouse/touch movement
    if (heroSection && robotContainer) {
      // MOUSE EVENTS
      heroSection.addEventListener("mousemove", (e) => {
        handleInteraction(e.clientX, e.clientY);
      });

      // TOUCH EVENTS for mobile
      heroSection.addEventListener("touchmove", (e) => {
        e.preventDefault();
        if (e.touches.length > 0) {
          const touch = e.touches[0];
          handleInteraction(touch.clientX, touch.clientY);
        }
      }, { passive: false });

      heroSection.addEventListener("touchstart", (e) => {
        if (e.touches.length > 0) {
          const touch = e.touches[0];
          handleInteraction(touch.clientX, touch.clientY);
        }
      });

      heroSection.addEventListener("touchend", () => {
        heroSection.classList.remove('mouse-active');
        mouseActive = false;

        if (mouseTimeout) {
          clearTimeout(mouseTimeout);
          mouseTimeout = null;
        }

        document.dispatchEvent(
          new CustomEvent("projectsRobotMouseLeave", {
            detail: { left: true },
          })
        );
      });

      // Remove active state when mouse leaves
      heroSection.addEventListener("mouseleave", () => {
        heroSection.classList.remove('mouse-active');
        mouseActive = false;

        if (mouseTimeout) {
          clearTimeout(mouseTimeout);
          mouseTimeout = null;
        }

        document.dispatchEvent(
          new CustomEvent("projectsRobotMouseLeave", {
            detail: { left: true },
          })
        );
      });

      // Reactivate on mouse enter
      heroSection.addEventListener("mouseenter", () => {
        document.dispatchEvent(
          new CustomEvent("projectsRobotMouseEnter", {
            detail: { entered: true },
          })
        );
      });
    }

    // ===== PARALLAX EFFECT ON SCROLL =====
    let ticking = false;
    window.addEventListener("scroll", () => {
      if (!ticking) {
        window.requestAnimationFrame(() => {
          const scrolled = window.scrollY;
          const heroContent = document.querySelector(".hero-content");

          if (heroContent && scrolled < window.innerHeight) {
            const opacity = Math.max(0, 1 - scrolled / (window.innerHeight * 0.7));
            const translateY = scrolled * 0.3;
            (heroContent as HTMLElement).style.opacity = opacity.toString();
            (heroContent as HTMLElement).style.transform = `translateY(${translateY}px)`;
          }

          ticking = false;
        });
        ticking = true;
      }
    });

    // ===== PROJECT CARD GLOW EFFECT =====
    const projectCards = document.querySelectorAll<HTMLElement>('.project-card');

    projectCards.forEach((card) => {
      const glowOverlay = card.querySelector<HTMLElement>('.glow-overlay');
      if (!glowOverlay) return;

      card.addEventListener('mousemove', (e) => {
        const rect = card.getBoundingClientRect();
        const x = ((e.clientX - rect.left) / rect.width) * 100;
        const y = ((e.clientY - rect.top) / rect.height) * 100;

        glowOverlay.style.setProperty('--mouse-x', `${x}%`);
        glowOverlay.style.setProperty('--mouse-y', `${y}%`);
      });

      card.addEventListener('mouseleave', () => {
        glowOverlay.style.setProperty('--mouse-x', '50%');
        glowOverlay.style.setProperty('--mouse-y', '50%');
      });
    });
  });
</script>
