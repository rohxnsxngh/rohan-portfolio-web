---
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";
import Layout from "../layouts/Layout.astro";
import Navbar from "../layouts/Navigation.astro";
import Footer from "../layouts/Footer.astro";

// Get all projects without any filtering
const allProjects: CollectionEntry<"project">[] = await getCollection("project");
console.log("Total projects found:", allProjects.length);

// Log each project for debugging
allProjects.forEach((project, index) => {
  console.log(`Project ${index + 1}:`, {
    title: project.data.title,
    status: project.data.status,
    slug: project.slug
  });
});

// Make sure we're properly filtering out any undefined projects
// but keep the filter very minimal to ensure all valid projects are included
const validProjects = allProjects.filter(project => project !== undefined);
console.log("Valid projects after filtering:", validProjects.length);

// Sort projects by status, with a fallback for any missing status
const sortedProjects = [...validProjects].sort((a, b) => {
  // Default status if missing
  const statusA = a.data?.status || "completed";
  const statusB = b.data?.status || "completed";
  
  // Sort by status (completed first, then in-progress, then coming-soon)
  const statusOrder = { completed: 0, "in-progress": 1, "coming-soon": 2 };
  return (statusOrder[statusA] || 0) - (statusOrder[statusB] || 0);
});

console.log("Projects after sorting:", sortedProjects.length);
---

<Layout>
  <Navbar>
    <div class="sm:px-20 px-6 py-8">
      <h1 class="font-semibold sm:text-5xl text-3xl tracking-wider mb-4">
        Projects & Experiments
      </h1>
      
      <!-- Grid with explicit dimensions -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 w-full">
        {allProjects.map((project, index) => (
          <div class="w-full h-[400px] relative">
            <a href={`/project/${project.slug}`} class="absolute inset-0 block">
              <div class="absolute inset-0 bg-base-200/50 hover:bg-base-200 border border-accent/20 rounded-xl p-6 flex flex-col transition-all duration-300 transform hover:-translate-y-1 hover:shadow-lg overflow-hidden">
                <div class="flex items-center justify-between mb-3">
                  <h2 class="text-xl font-bold text-white hover:text-primary/90 transition-colors truncate">
                    {project.data.title}
                  </h2>
                  <span class={`px-2 py-1 text-xs rounded-full flex-shrink-0 ml-2 ${
                    project.data.status === "completed" ? "bg-green-500/10 text-green-400" :
                    project.data.status === "in-progress" ? "bg-blue-500/10 text-blue-400" :
                    "bg-purple-500/10 text-purple-400"
                  }`}>
                    {project.data.status === "completed" ? "Completed" :
                     project.data.status === "in-progress" ? "In Progress" :
                     "Coming Soon"}
                  </span>
                </div>
                
                <p class="text-sm text-white/60 mb-4">
                  {new Date(project.data.date).toLocaleDateString("en-US", {
                    year: "numeric",
                    month: "long",
                  })}
                </p>
                
                <p class="text-white/80 flex-grow overflow-y-auto">
                  {project.data.description}
                </p>
                
                <div class="mt-4 flex flex-wrap gap-2">
                  {project.data.tags.map((tag: string) => (
                    <span class="text-sm px-3 py-1 rounded-lg bg-accent/20 text-white/90 border border-accent/30 hover:bg-accent/30 transition-colors duration-200">
                      {tag}
                    </span>
                  ))}
                </div>
                
                {(project.data.github || project.data.demo) && (
                  <div class="mt-4 pt-4 border-t border-accent/20 flex gap-4">
                    {project.data.github && (
                      <a
                        href={project.data.github}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="text-sm text-white/80 hover:text-white transition-colors"
                      >
                        GitHub →
                      </a>
                    )}
                    {project.data.demo && (
                      <a
                        href={project.data.demo}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="text-sm text-white/80 hover:text-white transition-colors"
                      >
                        Live Demo →
                      </a>
                    )}
                  </div>
                )}
              </div>
            </a>
          </div>
        ))}
      </div>
    </div>
  </Navbar>
  <Footer />
</Layout>

<style>
  /* Additional styles to ensure proper rendering */
  h2, p, span, a {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
    color: white !important;
  }
  
  span {
    display: inline-block !important;
  }
</style>